import{Deta as t}from"deta";import{z as n}from"zod";export{z}from"zod";var e;!function(t){t.Set="set",t.Trim="trim",t.Increment="increment",t.Append="append",t.Prepend="prepend"}(e||(e={}));var i=function(t,n){this.operation=void 0,this.value=void 0,this.operation=t,this.value=n};function r(t,n,e){if(!t.s){if(e instanceof o){if(!e.s)return void(e.o=r.bind(null,t,n));1&n&&(n=e.s),e=e.v}if(e&&e.then)return void e.then(r.bind(null,t,n),r.bind(null,t,2));t.s=n,t.v=e;const i=t.o;i&&i(t)}}var o=/*#__PURE__*/function(){function t(){}return t.prototype.then=function(n,e){var i=new t,o=this.s;if(o){var a=1&o?n:e;if(a){try{r(i,1,a(this.v))}catch(t){r(i,2,t)}return i}return this}return this.o=function(t){try{var o=t.v;1&t.s?r(i,1,n?n(o):o):e?r(i,1,e(o)):r(i,2,o)}catch(t){r(i,2,t)}},i},t}();function a(t){return t instanceof o&&1&t.s}var u=/*#__PURE__*/function(){function t(t,r,o){void 0===o&&(o=!0),this.base=void 0,this.schema=void 0,this.validation=void 0,this.manySchema=void 0,this.util={trim:function(){return new i(e.Trim,void 0)},increment:function(t){return new i(e.Increment,t)},append:function(t){return new i(e.Append,t)},prepend:function(t){return new i(e.Prepend,t)}},this.base=t,this.schema=r,this.validation=o,this.manySchema=n.array(r)}var u=t.prototype;return u.put=function(t,n,e){return this.parse(t),this.base.put(t,n,e)},u.get=function(t){return this.base.get(t)},u.insert=function(t,n,e){return this.parse(t),this.base.insert(t,n,e)},u.putMany=function(t,n){try{var e=this;return e.parse.apply(e,t),Promise.resolve(e.base.putMany(t,n))}catch(t){return Promise.reject(t)}},u.update=function(t,n,r){var o=this;return t=Object.fromEntries(Object.entries(t).map(function(t){var n=t[0],r=t[1];if(r instanceof i)switch(r.operation){case e.Append:return[n,o.base.util.append(r.value)];case e.Increment:return[n,o.base.util.increment(r.value)];case e.Prepend:return[n,o.base.util.prepend(r.value)];case e.Trim:return[n,o.base.util.trim()]}return[n,r]})),this.base.update(t,n,r)},u.fetch=function(t,n){try{var e,i=this,u=null!=(e=null==n?void 0:n.limit)?e:Infinity;return Promise.resolve(i.base.fetch(t,n)).then(function(e){var s=function(t,n,e){for(var i;;){var u=t();if(a(u)&&(u=u.v),!u)return s;if(u.then){i=0;break}var s=e();if(s&&s.then){if(!a(s)){i=1;break}s=s.s}if(n){var c=n();if(c&&c.then&&!a(c)){i=2;break}}}var h=new o,f=r.bind(null,h,2);return(0===i?u.then(d):1===i?s.then(v):c.then(p)).then(void 0,f),h;function v(i){s=i;do{if(n&&(c=n())&&c.then&&!a(c))return void c.then(p).then(void 0,f);if(!(u=t())||a(u)&&!u.v)return void r(h,1,s);if(u.then)return void u.then(d).then(void 0,f);a(s=e())&&(s=s.v)}while(!s||!s.then);s.then(v).then(void 0,f)}function d(t){t?(s=e())&&s.then?s.then(v).then(void 0,f):v(s):r(h,1,s)}function p(){(u=t())?u.then?u.then(d).then(void 0,f):d(u):r(h,1,s)}}(function(){return!(null==n||!n.autoPaginate)&&e.count<u},void 0,function(){return Promise.resolve(i.base.fetch(t,{limit:u-e.count,last:e.last,desc:null==n?void 0:n.desc})).then(function(t){var n;e.last=t.last,(n=e.items).push.apply(n,t.items),e.count+=t.count})});return s&&s.then?s.then(function(){return e}):e})}catch(t){return Promise.reject(t)}},u.delete=function(t){return this.base.delete(t)},u.parse=function(){this.validation&&this.manySchema.parse([].slice.call(arguments))},t}(),s=/*#__PURE__*/function(){function t(t){this.deta=void 0,this.deta=t}var n=t.prototype;return n.Base=function(t,n){return this.deta.Base(t,n)},n.Drive=function(t,n){return this.deta.Drive(t,n)},n.SchemaBase=function(t,n,e,i){return void 0===e&&(e=!0),new u(this.deta.Base(t,i),n,e)},t}();function c(n,e){return new s(t(n,e))}export{c as Deta};
//# sourceMappingURL=index.esm.mjs.map
